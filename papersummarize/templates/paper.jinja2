{% extends 'layout.jinja2' %}

{% block subtitle %}Summarize - {% endblock subtitle %}

{% block content %}
<p>{{ content|safe }}</p>
<div id="paper-info">
    <h3><a href="{{request.route_url('view_paper', arxiv_id=paper_object.arxiv_id)}}">{{paper_object.title}}</a></h3>
    <p>
{% for author in paper_object.authors %}
    {{ author.name }}{% if loop.last %}.{% else %}, {% endif %}
{% endfor %}
    </p>
    <p>published at {{paper_object.published}}</p>
    <p>
    {{ paper_object.abstract }}
    </p>
</div>
{% if request.user %}
<div id="paper-tags">
    <p>Tags: (<a href="{{ request.route_url('add_tag', arxiv_id=paper.arxiv_id) }}">Add a new tag.</a>)</p>
    <ul>
    {% for tag in tags %}
        <li>
        <span><a href="{{request.route_url('view_user_taglist', user_name=request.user.name, tag_name=tag.name)}}">{{ tag.name }}</a></span> 
        <span><a href="{{request.route_url('delete_tag', arxiv_id=paper_object.arxiv_id, tag_name=tag.name)}}">x</a></span>
        </li>
    {% endfor %}
    </ul>
</div>
{% endif %}

<div id="paper-rating-info">
    <p>
        <span>Total Score:</span>
        <span><strong>{{ total_rating }}</strong> (from {{ num_ratings }} ratings)</span>
    </p>

    {% if has_rated_paper %}
    <p>
        <span>Your Rating:</span>
        <span><strong>{{ your_paper_rating.rating }}</strong></span>
        <span><a href="{{request.route_url('delete_paper_rating', arxiv_id=paper_object.arxiv_id) }}">x</a></span>
    </p>
    {% else %}
    <p>
        <span>Add Rating:</span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=1) }}">1</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=2) }}">2</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=3) }}">3</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=4) }}">4</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=5) }}">5</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=6) }}">6</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=7) }}">7</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=8) }}">8</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=9) }}">9</a></span>
        <span><a href="{{ request.route_url('add_paper_rating', arxiv_id=paper_object.arxiv_id, rating=10) }}">10</a></span>
    </p>  
    {% endif %}
</div>

<div id="paper-summary-info">
    Summary Count: <strong>{{ num_summaries }}</strong> {% if has_wrote %}
            (<a href="{{ request.route_url('view_summary', arxiv_id=paper.arxiv_id, user_name=request.user.name) }}">View your summary.</a>)
            {% else %}
            (<a href="{{ request.route_url('add_summary', arxiv_id=paper.arxiv_id) }}">Add a new summary.</a>)
    {% endif %}
</div>

<div id="paper-tip-info">
Tip Count: <strong>{{ num_tips }}</strong> (<a href="{{ request.route_url('add_tip', arxiv_id=paper.arxiv_id) }}">Add a new tip.</a>)
</div>

{% if summaries is none %}
<p></p>
{% else %}
<div>
<p>Summaries:</p>
<ul>
{% for summary in summaries %}
    <li>
    <div>
    <p>{{ summary.data }}</p>
    <p>by <a href="{{ request.route_url('view_user', user_name=summary.creator.name) }}">{{ summary.creator.name }}</a> on <a href="{{ request.route_url('view_summary', arxiv_id=paper.arxiv_id, user_name=summary.creator.name) }}">{{ summary.created_at_formatted }}</a></p>
    </div>
    </li>
{% endfor %}
</ul>
</div>
{% endif %}

{% if tips is none %}
<p></p>
{% else %}
<div>
<p>Tips:</p>
<ul>
{% for tip in tips %}
    <li>
    <div>
    <p data-linkify="this">{{ tip.data }}</p>
    <p>by <a href="{{ request.route_url('view_user', user_name=tip.creator.name) }}">{{ tip.creator.name }}</a> on <a href="{{ request.route_url('view_tip', arxiv_id=paper.arxiv_id, tip_id=tip.id) }}">{{ tip.created_at_formatted }}</a></p>
    </div>
    </li>
{% endfor %}
</ul>
</div>
{% endif %}

{% endblock content %}

{% block js %}
<script src="{{request.static_url('papersummarize:static/js/shared/linkify.min.js')}}"></script>
<script src="{{request.static_url('papersummarize:static/js/shared/linkify-jquery.min.js')}}"></script>
{% endblock %}
